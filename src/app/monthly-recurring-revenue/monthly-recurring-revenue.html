<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header"> Monthly Recurring Revenue</h1>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <form class="form-inline">
          <div class="form-group">
            <label for="startDate">Range: </label>
            <input type="date" id="start-date" class="form-control" name="startDate" ng-model="monthlyRecurringRevenueVm.dateRange.startDate"
                   placeholder="yyyy-MM-dd"/>
          </div>
          <div class="form-group">
            <label for="endDate">-</label>
            <input type="date" id="end-date" class="form-control" name="endDate" ng-model="monthlyRecurringRevenueVm.dateRange.endDate"
                   placeholder="yyyy-MM-dd"/>
          </div>
          <div class="form-group">
            <button type="button" class="btn btn-primary" name="date-update" ng-click="monthlyRecurringRevenueVm.lineChartFilter()">Go! <i class="fa fa-arrow-right fa-fw"></i></button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <highchart config="monthlyRecurringRevenueVm.lineChartConfig"></highchart>
      </div>

      <div class="panel-footer">
        <div class="row">
        <form>
          <div class="col-sm-6 form-group">
            <label for="rangeSelectBtn">Range: </label>
            <select class="form-control" ng-model="monthlyRecurringRevenueVm.selectedRange" name="rangeSelectBtn" id="range-select-btn" ng-change="monthlyRecurringRevenueVm.lineChartFilter()">
              <option ng-repeat="range in monthlyRecurringRevenueVm.availableRanges" value="{{range}}">{{range | titleCase}}</option>
            </select>
          </div>
          <div class="col-sm-6 form-group">
            <label for="deviceSelectBtn">Device: </label>
            <select class="form-control" ng-model="monthlyRecurringRevenueVm.selectedDeviceFilter" name="deviceSelectBtn" id="device-select-btn" ng-change="monthlyRecurringRevenueVm.lineChartFilter()">
              <option value="all">All</option>
              <option ng-repeat="device in monthlyRecurringRevenueVm.availableDevices" value="{{device}}">{{device | device}}</option>
            </select>
          </div>
        </form>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Table -->
<div class="row">
  <div class="col-sm-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            {{monthlyRecurringRevenueVm.selectedRange | titleCase}}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
            <li ng-repeat="range in monthlyRecurringRevenueVm.availableRanges">
              <a href="" ng-click="monthlyRecurringRevenueVm.selectDropdownRange(range)">{{range | titleCase}}</a>
            </li>
          </ul>
          <button class="btn btn-success pull-right" type="button" name="downloadCSV" id="user-stats-download-btn" ng-click="monthlyRecurringRevenueVm.fetchAndDownloadCSV(monthlyRecurringRevenueVm.reversedCumulativeSumDataContainer,'LineChart')">
              export CSV
          </button>
        </div>
      </div>
      <table class="table table-striped table-bordered table-hover" id="linechart-table">
        <thead>
          <tr>
            <th class="col-sm-4">Date</th>
            <th class="col-sm-4 text-right">MRR</th>
            <th class="col-sm-4 text-right">Change Net / %</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="item in monthlyRecurringRevenueVm.reversedCumulativeSumDataContainer">
            <td class="col-sm-4" ng-style="monthlyRecurringRevenueVm.getDateColor({{item[0]}})">{{item[0] | date:'yyyy. MM. dd (EEE)'}}</td>
            <td class="col-sm-4 text-right">{{item[3] | number}}</td>
            <td class="col-sm-4 text-right increased" ng-if="item[4] > 0">
              <b>{{item[4] | number}}</b>
              ( {{item[5] | number}} - {{item[6] | number}})
              <span ng-if="item[7] === '-'"> - </span>
              <span ng-if="item[7] != '-'">
              <i class="fa fa-sort-asc fa-fw"></i>
              {{(item[7]) | percentage:2}}
              </span>
            </td>
            <td class="col-sm-4 text-right decreased" ng-if="item[4] < 0">
              <b>{{item[4] | number}}</b>
              ( {{item[5] | number}} - {{item[6] | number}})
              <span ng-if="item[7] === '-'"> - </span>
              <span ng-if="item[7] != '-'">
              <i class="fa fa-sort-desc fa-fw"></i>
              {{(item[7]) | percentage:2}}
              </span>
            </td>
            <td class="col-sm-4 text-right" ng-if="item[4] === 0 && item[7]!== '-'">
              0 <i class="fa fa-fw">-</i> 0.00%
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="text-center">
      <uib-pagination boundary-links="true" total-items="monthlyRecurringRevenueVm.totalItem" ng-model="monthlyRecurringRevenueVm.currentPage"
                      ng-change="monthlyRecurringRevenueVm.pageChanged(monthlyRecurringRevenueVm.currentPage)" items-per-page="20" max-size="10" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination>
    </div>
  </div>
</div>
